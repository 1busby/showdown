<ng-container *ngIf="this.tournament">
  <div id="tournament-name">
    <p>
      {{ this.tournament?.name }}
      <ng-container
        *ngIf="
          !tournament.hasStarted &&
          (!tournament.createdBy ||
            tournament.createdBy._id === loggedInUser?._id)
        "
      >
        <ng-container *ngIf="isCheckingEditAccess">
          <mat-spinner color="accent" diameter="30"></mat-spinner>
        </ng-container>
        <ng-container *ngIf="!isCheckingEditAccess">
          <button mat-icon-button color="primary" (click)="editTournament()">
            <mat-icon>edit</mat-icon>
          </button>
          <button
            mat-icon-button
            color="primary"
            (click)="editTournament(true)"
          >
            <mat-icon>play_arrow</mat-icon>
          </button>
        </ng-container>
      </ng-container>
    </p>
  </div>

  <div class="content-large">
    <div class="large-box">
      <bracket-view
        [tournament]="this.tournament"
        (showMatchDetailsEmitter)="showMatchDetails($event)"
      ></bracket-view>

      <div class="side-list">
        <mat-button-toggle-group
          class="action-buttons"
          #group="matButtonToggleGroup"
        >
          <mat-button-toggle
            value="justify"
            (click)="showView('updates')"
            aria-label="Updates"
          >
            <mat-icon>dynamic_feed</mat-icon>
          </mat-button-toggle>

          <mat-button-toggle
            value="center"
            (click)="showView('contestants')"
            aria-label="Contestants"
          >
            <mat-icon>people</mat-icon>
          </mat-button-toggle>

          <mat-button-toggle
            value="right"
            (click)="showView('matches')"
            aria-label="Matches"
          >
            <mat-icon>format_list_numbered</mat-icon>
          </mat-button-toggle>

          <mat-button-toggle
            *ngIf="
              !tournament.hasStarted &&
              (!tournament.createdBy ||
                tournament.createdBy._id === loggedInUser?._id)
            "
            value="justify"
            (click)="showView('requests')"
            aria-label="Updates"
          >
            <mat-icon>how_to_reg</mat-icon>
          </mat-button-toggle>
        </mat-button-toggle-group>


        <sd-update-list *ngIf="viewBeingShown === 'updates' || viewBeingShown === 'bracket'" [updates]="tournament.updates"> </sd-update-list>

        <ng-container label="Contestants" *ngIf="viewBeingShown === 'contestants'">
          <div>
            {{ this.tournament?.contestants?.length || 0 }} /
            {{ this.tournament?.contestantCount || 0 }} Contestants Registered
          </div>
          <contestant-list
            interactionMode="view"
            [contestants]="this.tournament?.contestants || []"
          ></contestant-list>
        </ng-container>
    
        <ng-container label="Matches" *ngIf="viewBeingShown === 'matches'">
          <match-list
            [matches]="this.appStore.getWinnersMatchContainers() | async"
            (showMatchDetailsEmitter)="showMatchDetails($event)"
          ></match-list>
        </ng-container>
      </div>
    </div>
  </div>

  <div class="content-small">
    <ng-container label="Brackets" *ngIf="viewBeingShown === 'bracket'">
      <bracket-view
        [tournament]="this.tournament"
        (showMatchDetailsEmitter)="showMatchDetails($event)"
      ></bracket-view>
    </ng-container>

    <ng-container label="Contestants" *ngIf="viewBeingShown === 'contestants'">
      <div>
        {{ this.tournament?.contestants?.length || 0 }} /
        {{ this.tournament?.contestantCount || 0 }} Contestants Registered
      </div>
      <contestant-list
        interactionMode="view"
        [contestants]="this.tournament?.contestants || []"
      ></contestant-list>
    </ng-container>

    <ng-container label="Matches" *ngIf="viewBeingShown === 'matches'">
      <match-list
        [matches]="this.appStore.getWinnersMatchContainers() | async"
        (showMatchDetailsEmitter)="showMatchDetails($event)"
      ></match-list>
    </ng-container>

    <ng-container label="Updates" *ngIf="viewBeingShown === 'updates'">
      <sd-update-list [updates]="tournament.updates"> </sd-update-list>
    </ng-container>

    <ng-container label="Requests" *ngIf="viewBeingShown === 'requests'">
      <div>
        <ng-container *ngFor="let request of tournament.registrationRequests">
          <div *ngIf="!request.isReviewed">
            {{
              request.contestant.profile?.username || request.contestant.name
            }}
            wants to join the tournament
            <button
              mat-stroked-button
              color="primary"
              (click)="reviewRegistrationRequest(request, true)"
            >
              APPROVE
            </button>
            <button
              mat-stroked-button
              color="warn"
              (click)="reviewRegistrationRequest(request, false)"
            >
              DENY
            </button>
          </div>
        </ng-container>
      </div>
    </ng-container>
  </div>

  <mat-button-toggle-group
    class="action-buttons small-screen"
    #group="matButtonToggleGroup"
  >
    <mat-button-toggle
      color="primary"
      value="left"
      (click)="showView('bracket')"
      aria-label="Bracket View"
    >
      <mat-icon>schema</mat-icon>
    </mat-button-toggle>

    <mat-button-toggle
      value="center"
      (click)="showView('contestants')"
      aria-label="Contestants"
    >
      <mat-icon>people</mat-icon>
    </mat-button-toggle>

    <mat-button-toggle
      value="right"
      (click)="showView('matches')"
      aria-label="Matches"
    >
      <mat-icon>format_list_numbered</mat-icon>
    </mat-button-toggle>

    <mat-button-toggle
      value="justify"
      (click)="showView('updates')"
      aria-label="Updates"
    >
      <mat-icon>dynamic_feed</mat-icon>
    </mat-button-toggle>

    <mat-button-toggle
      *ngIf="
        !tournament.hasStarted &&
        (!tournament.createdBy ||
          tournament.createdBy._id === loggedInUser?._id)
      "
      value="justify"
      (click)="showView('requests')"
      aria-label="Updates"
    >
      <mat-icon>how_to_reg</mat-icon>
    </mat-button-toggle>
  </mat-button-toggle-group>
</ng-container>

<button
  *ngIf="
    tournament?.allowRegistration &&
    tournament?.contestants?.length < tournament?.contestantCount &&
    !checkIfContestant() &&
    !checkIfWaitingApproval()
  "
  mat-fab
  color="primary"
  (click)="joinClicked()"
  class="join-button"
>
  <mat-icon style="font-weight: bold" svgIcon="swords"></mat-icon>
</button>
